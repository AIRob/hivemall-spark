Copyed from spark master [commit 4ce2782a61e23ed0326faac2ee97a9bd36ec8963]
